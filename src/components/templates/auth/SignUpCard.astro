---
export const prerender = false;

import FormGroup from '@components/ui/Form/FormGroup.astro';
import Label from '@components/ui/Form/Label.astro';
import Input from '@components/ui/Form/Input.astro';
import PasswordInput from '@components/ui/Form/PasswordInput.astro';
import Button from '@components/ui/Button.astro';
import Alert from '@components/ui/Alert.astro';
import Link from '@components/ui/Link.astro';

interface Props {
    translations?: Record<string, any>;
    title?: string;
    status?: { type: "success" | "error"; message: string } | null;
    lastEmail?: string;
    lastName?: string;
}

const props = Astro.props as Props;
const translations = props.translations ?? {};
const t = (translations?.auth ?? translations) as Record<string, any>;
const title = props.title ?? t.registerTitle ?? t.signUp ?? translations.registerTitle ?? "Inscription";
const status = props.status ?? null;
const lastEmail = props.lastEmail ?? "";
const lastName = props.lastName ?? "";

const resolveRoute = (value: unknown, fallback: string) => {
    return typeof value === "string" && value.startsWith("/") ? value : fallback;
};

const loginUrl = resolveRoute(t.loginPageUrl ?? t.loginUrl ?? translations.loginPageUrl, "/login");
const alreadyHaveAccountPrompt = t.alreadyHaveAccountPrompt ?? translations.alreadyHaveAccountPrompt ?? "Vous avez déjà un compte ?";
const loginLinkLabel = t.loginLinkLabel ?? t.signIn ?? translations.loginLinkLabel ?? "Connectez-vous";
---
<div class="card w-full max-w-md space-y-5 p-6">
    <div class="flex flex-wrap items-center justify-between gap-3 text-sm text-muted-foreground">
        <span>{alreadyHaveAccountPrompt}</span>
        <Link class="button ghost small" href={loginUrl}>{loginLinkLabel}</Link>
    </div>
    <header>
        <p class="text-sm uppercase tracking-wide text-slate-500">{t.registerTitle ?? translations.registerTitle}</p>
        <h1 class="text-2xl font-semibold text-slate-900">{title}</h1>
    </header>

    {status && (
        <Alert status={status.type === "error" ? "error" : "success"} aria-live="assertive">
            {status.message}
        </Alert>
    )}

    <form method="POST" class="space-y-4">
        <FormGroup>
            <Label htmlFor="name">{t.nameLabel ?? translations.nameLabel ?? "Nom"}</Label>
            <Input
                id="name"
                name="name"
                type="text"
                value={lastName}
                required
                autocomplete="name"
            />
        </FormGroup>

        <FormGroup>
            <Label htmlFor="email">{t.emailLabel ?? translations.emailLabel ?? "Adresse email"}</Label>
            <Input
                id="email"
                name="email"
                type="email"
                value={lastEmail}
                required
                autocomplete="email"
            />
        </FormGroup>

        <FormGroup>
            <Label htmlFor="password">{t.passwordLabel ?? translations.passwordLabel ?? "Mot de passe"}</Label>
            <PasswordInput
                id="password"
                name="password"
                required
                autocomplete="new-password"
            />
        </FormGroup>

        <FormGroup>
            <Label htmlFor="confirmPassword">{t.confirmPasswordLabel ?? translations.confirmPasswordLabel ?? "Confirmer le mot de passe"}</Label>
            <PasswordInput
                id="confirmPassword"
                name="confirmPassword"
                required
                autocomplete="new-password"
            />
        </FormGroup>

        <Button type="submit" class="w-full">{t.registerButton ?? translations.registerButton ?? "Créer un compte"}</Button>
    </form>
</div>